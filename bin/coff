#!/usr/bin/env ruby
# -*- coding: utf-8 -*-

require 'coffee_without_nodejs'
require 'coderay'

if ARGV.first == '-e'
  ARGV.shift
  content = CoffeeWithoutNodejs.compile(ARGV.first).to_s
  print CodeRay.scan(content, :js).terminal unless content.empty?
else
  if ARGV.empty?
    `notify-send 'Starting coffee compiler.' -t 1000` if system 'which notify-send &>/dev/null'
    CoffeeWithoutNodejs.watch!
  elsif test 'd', ARGV.first
    Dir.chdir(ARGV.first) { CoffeeWithoutNodejs.watch! }
  else
    ARGV.each do |file|
      fail "`#{file}' is not valid filename." unless File.exist? file

      content = CoffeeWithoutNodejs.compile(file).to_s
      unless content.empty?
        token = CodeRay.scan(content, :js)
        print $stdout.tty? ? token.terminal : token.text
      end
    end
  end
end
